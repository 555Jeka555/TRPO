@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

title C4 Уровень 2: Контейнеры - Фриланс-Биржа

Person(freelancer, "Фрилансер", "Выполняет работу")
Person(client, "Клиент", "Заказывает услуги")
Person(admin, "Администратор", "Управляет системой")

System_Boundary(freelance_system, "Фриланс-Биржа") {
    Container(web_app, "Веб-приложение", "React/TypeScript", "SPA приложение для пользователей")
    Container(mobile_app, "Мобильное приложение", "React Native", "Мобильное приложение для iOS/Android")
    Container(api_gateway, "API Gateway", "Nginx/Kong", "Единая точка входа для API")

    Container(user_service, "Сервис пользователей", "Go", "Управление пользователями и аутентификация")
    Container(project_service, "Сервис проектов", "Go", "Управление проектами и поиск")
    Container(bidding_service, "Сервис заявок", "Go", "Управление заявками и предложениями")
    Container(payment_service, "Сервис платежей", "Go", "Обработка платежей и транзакций")
    Container(notification_service, "Сервис уведомлений", "Go", "Отправка уведомлений")
    Container(review_service, "Сервис отзывов", "Go", "Управление отзывами и рейтингами")
    Container(moderation_service, "Сервис модерации", "Go", "Асинхронная модерация проектов и заявок")
    Container(dispute_service, "Сервис споров", "Go", "Разрешение конфликтных ситуаций")

    ContainerDb(mysql_db, "MySQL Database", "MySQL", "Хранение основных данных: пользователи, проекты, заявки, платежи")
    ContainerDb(redis_cache, "Redis Cache", "Redis", "Кеширование и сессии")
    ContainerDb(cassandra_db, "Cassandra", "Apache Cassandra", "Хранение сообщений чата и уведомлений")
    ContainerDb(elasticsearch, "Elasticsearch", "Elasticsearch", "Поиск проектов и фрилансеров")

    Container(message_queue, "Message Queue", "RabbitMQ", "Асинхронная обработка задач")
    Container(comet_server, "Comet Server", "Go", "Пуш-уведомления и онлайн-чат")
}

System_Ext(payment_gateway, "Платежный шлюз", "Stripe/PayPal")
System_Ext(email_service, "Email провайдер", "SendGrid/Amazon SES")
System_Ext(sms_service, "SMS провайдер", "Twilio")

' Пользовательские взаимодействия
Rel(freelancer, web_app, "Ищет проекты, подает заявки", "HTTPS")
Rel(freelancer, mobile_app, "Использует мобильное приложение", "HTTPS")
Rel(client, web_app, "Публикует проекты, управляет заказами", "HTTPS")
Rel(admin, web_app, "Модерирует систему через админ-панель", "HTTPS")

' Frontend to Backend
Rel(web_app, api_gateway, "API запросы", "REST/HTTPS")
Rel(mobile_app, api_gateway, "API запросы", "REST/HTTPS")

' API Gateway to Services
Rel(api_gateway, user_service, "Маршрутизация запросов", "gRPC")
Rel(api_gateway, project_service, "Маршрутизация запросов", "gRPC")
Rel(api_gateway, bidding_service, "Маршрутизация запросов", "gRPC")
Rel(api_gateway, payment_service, "Маршрутизация запросов", "gRPC")
Rel(api_gateway, notification_service, "Маршрутизация запросов", "gRPC")
Rel(api_gateway, review_service, "Маршрутизация запросов", "gRPC")
Rel(api_gateway, dispute_service, "Маршрутизация запросов", "gRPC")

' Services to Databases
Rel(user_service, mysql_db, "Чтение/запись данных", "JDBC")
Rel(project_service, mysql_db, "Чтение/запись данных", "JDBC")
Rel(bidding_service, mysql_db, "Чтение/запись данных", "JDBC")
Rel(payment_service, mysql_db, "Чтение/запись данных", "JDBC")
Rel(review_service, mysql_db, "Чтение/запись данных", "JDBC")
Rel(dispute_service, mysql_db, "Чтение/запись данных", "JDBC")

' Caching and Search
Rel(project_service, elasticsearch, "Поиск проектов", "REST")
Rel(user_service, redis_cache, "Кеширование сессий", "Redis protocol")
Rel(project_service, redis_cache, "Кеширование каталога", "Redis protocol")
Rel(notification_service, cassandra_db, "Хранение уведомлений", "CQL")

' Message Queue and Async Processing
Rel(project_service, message_queue, "Отправка задач модерации", "AMQP")
Rel(bidding_service, message_queue, "Отправка задач модерации", "AMQP")
Rel(message_queue, moderation_service, "Обработка задач", "AMQP")
Rel(moderation_service, mysql_db, "Обновление статусов", "JDBC")

' Real-time Communication
Rel(notification_service, comet_server, "Отправка уведомлений", "WebSocket")
Rel(comet_server, web_app, "Пуш-уведомления и чат", "WebSocket")
Rel(comet_server, mobile_app, "Пуш-уведомления и чат", "WebSocket")
Rel(comet_server, cassandra_db, "Хранение сообщений", "CQL")

' External Services
Rel(payment_service, payment_gateway, "Обработка платежей", "HTTPS")
Rel(notification_service, email_service, "Отправка email", "SMTP/HTTPS")
Rel(notification_service, sms_service, "Отправка SMS", "HTTPS")

@enduml